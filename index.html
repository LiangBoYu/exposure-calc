<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>曝光計算器</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&family=Fraunces:wght@600&display=swap" rel="stylesheet" />
  <style>
    :root { --bg: #0e1b26; --bg2: #1b2a3b; --ink: #f4f2ed; --muted: #b7c4cf; --accent: #f1a208; --accent2: #58d6c8; --card: rgba(255, 255, 255, 0.08); --stroke: rgba(255, 255, 255, 0.18); }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; color: var(--ink); font-family: "Space Grotesk", sans-serif; background: linear-gradient(160deg, var(--bg), var(--bg2)); min-height: 100svh; }
    header { padding: 24px 16px; text-align: center; }
    main { display: grid; gap: 10px; padding: 10px; width: min(96vw, 600px); margin: 0 auto; }
    .card { background: var(--card); border: 1px solid var(--stroke); border-radius: 14px; padding: 15px; backdrop-filter: blur(10px); }
    .section-title { font-weight: 600; font-size: 13px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .pill { font-size: 10px; padding: 2px 8px; border-radius: 999px; background: rgba(88, 214, 200, 0.2); color: var(--accent2); }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    label { display: block; font-size: 11px; color: var(--muted); margin-bottom: 5px; }
    select { width: 100%; padding: 12px; border-radius: 10px; border: none; background: rgba(255, 255, 255, 0.12); color: var(--ink); font-size: 16px; }
    .time { font-size: 38px; font-weight: 700; color: var(--accent); text-align: center; margin: 15px 0; }
    button { width: 100%; border: none; border-radius: 999px; padding: 12px; font-weight: 600; background: var(--accent); color: #1a1202; }
    .note { color: var(--muted); font-size: 11px; line-height: 1.5; margin-top: 10px; }
  </style>
</head>
<body>
  <header><h1>曝光計算器</h1></header>
  <main>
    <section class="card">
      <div class="section-title">環境亮度 <span class="pill">EV</span></div>
      <div style="text-align:center; font-size: 24px; color: var(--accent2);" id="scene-ev">--</div>
    </section>
    <section class="card">
      <div class="section-title">基準參數 <span class="pill">Base</span></div>
      <div class="grid">
        <div><label>光圈 (f)</label><select id="base-aperture"></select></div>
        <div><label>快門</label><select id="base-shutter"></select></div>
        <div><label>ISO</label><select id="base-iso"></select></div>
        <div><label>ND 檔數</label><select id="base-nd"></select></div>
      </div>
    </section>
    <section class="card">
      <div class="section-title">目標參數 <span class="pill">Target</span></div>
      <div class="grid">
        <div><label>光圈 (f)</label><select id="target-aperture"></select></div>
        <div><label>ISO</label><select id="target-iso"></select></div>
        <div style="grid-column: span 2;"><label>ND (檔)</label><select id="target-nd"></select></div>
      </div>
      <div class="note" id="result-note">計算中...</div>
    </section>
    <section class="card">
      <div class="time" id="base-time">--</div>
      <button id="countdown-btn">開始倒數</button>
      <div class="note" style="text-align:center">剩餘：<span id="countdown-display">--</span></div>
    </section>
  </main>

  <script>
    const selects = {
      ba: document.getElementById("base-aperture"),
      bs: document.getElementById("base-shutter"),
      bi: document.getElementById("base-iso"),
      bn: document.getElementById("base-nd"),
      ta: document.getElementById("target-aperture"),
      ti: document.getElementById("target-iso"),
      tn: document.getElementById("target-nd")
    };

    const fOps = [1.0, 1.4, 2, 2.8, 4, 5.6, 8, 11, 16, 22, 32];
    const iOps = [50, 100, 200, 400, 800, 1600, 3200, 6400, 12800];
    const nOps = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 13, 15];
    const sOps = [
      {l:"30s",v:30},{l:"15s",v:15},{l:"8s",v:8},{l:"4s",v:4},{l:"2s",v:2},{l:"1s",v:1},
      {l:"1/2",v:0.5},{l:"1/4",v:0.25},{l:"1/8",v:0.125},{l:"1/15",v:1/15},{l:"1/30",v:1/30},
      {l:"1/60",v:1/60},{l:"1/125",v:1/125},{l:"1/250",v:1/250},{l:"1/500",v:1/500}
    ];

    function log2(x) { return Math.log(x)/Math.log(2); }

    function init() {
      fOps.forEach(v => {
        selects.ba.add(new Option(`f/${v}`, v));
        selects.ta.add(new Option(`f/${v}`, v));
      });
      sOps.forEach(o => selects.bs.add(new Option(o.l, o.v)));
      iOps.forEach(v => {
        selects.bi.add(new Option(v, v));
        selects.ti.add(new Option(v, v));
      });
      nOps.forEach(v => {
        selects.bn.add(new Option(`${v} 檔`, v));
        selects.tn.add(new Option(`${v} 檔`, v));
      });

      selects.ba.value = "16"; selects.bs.value = "15"; selects.bi.value = "100";
      selects.ta.value = "8"; selects.ti.value = "6400"; selects.tn.value = "5";

      const calc = () => {
        const N1 = Number(selects.ba.value), t1 = Number(selects.bs.value), I1 = Number(selects.bi.value), ND1 = Number(selects.bn.value);
        const N2 = Number(selects.ta.value), I2 = Number(selects.ti.value), ND2 = Number(selects.tn.value);

        const ev100 = log2((N1*N1)/t1) - log2(I1/100);
        const sceneEv = ev100 + ND1;
        const t2 = (N2*N2) / (Math.pow(2, sceneEv - ND2) * (I2/100));

        document.getElementById("scene-ev").textContent = sceneEv.toFixed(2);
        document.getElementById("base-time").textContent = t2 >= 1 ? ${t2.toFixed(1)}s : `1/${Math.round(1/t2)}s`;
        window.currentT2 = t2;

        const apS = 2*log2(N2/N1), isoS = log2(I2/I1), ndS = ND2-ND1;
        document.getElementById("result-note").innerHTML = `光圈: ${apS.toFixed(1)}檔 | ISO: ${isoS.toFixed(1)}檔 | ND: ${ndS.toFixed(1)}檔`;
      };

      Object.values(selects).forEach(s => s.onchange = calc);
      calc();
    }

    let timer = null;
    document.getElementById("countdown-btn").onclick = () => {
      if (timer) { clearInterval(timer); timer = null; return; }
      let rem = window.currentT2;
      timer = setInterval(() => {
        rem -= 0.1;
        if (rem <= 0) { clearInterval(timer); timer = null; document.getElementById("countdown-display").textContent = "完成"; return; }
        document.getElementById("countdown-display").textContent = rem.toFixed(1) + "s";
      }, 100);
    };

    init();
  </script>
</body>
</html>
